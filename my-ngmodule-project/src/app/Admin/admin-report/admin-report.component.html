<!-- admin-report.component.html -->
<div class="report-page p-6 bg-slate-50 min-h-screen">
  <!-- controls (small, still available) -->
  <div class="controls mb-4 flex flex-wrap items-center gap-3 justify-between">
    <div class="flex items-center gap-3">
      <label class="text-sm font-medium">Report Type</label>
      <select [(ngModel)]="reportType" (change)="onReportTypeChange()" class="border px-3 py-1 rounded">
        <option value="MONTHLY">Monthly</option>
        <option value="QUARTERLY">Quarterly</option>
        <option value="YEARLY">Yearly</option>
      </select>

      <input *ngIf="reportType==='MONTHLY'" type="month" [(ngModel)]="selectedMonth" class="border px-3 py-1 rounded">
      <input *ngIf="reportType==='QUARTERLY'" type="number" min="1" max="4" [(ngModel)]="selectedQuarter" placeholder="Quarter (1–4)" class="border px-3 py-1 rounded w-28">
      <input type="number" min="2000" max="2100" [(ngModel)]="selectedYear" placeholder="Year" class="border px-3 py-1 rounded w-28">
      <button mat-flat-button color="primary" (click)="loadReport()">Generate</button>
    </div>

    <div class="actions flex items-center gap-2">
      <button mat-stroked-button color="primary" (click)="downloadReport()">Download PDF</button>
      <button mat-stroked-button color="accent" (click)="printReport()">Print</button>
    </div>
  </div>

  <!-- Actual report content (paper-like) -->
  <div #reportContent class="paper max-w-[900px] mx-auto bg-white shadow-md p-6 print:shadow-none print:p-0">
    <!-- Header -->
    <div class="header flex justify-between items-start border-b pb-4 mb-6">
      <div>
        <h1 class="report-title text-2xl font-bold text-slate-800">Venue Booking Summary Report</h1>
        <p class="text-sm text-slate-500 mt-1">ZSSF Venue Booking System</p>
      </div>
      <div class="text-right text-sm text-slate-600">
        <div><strong>Generated:</strong> {{ dateGenerated }}</div>
        <div><strong>Report Period:</strong> {{ reportPeriod || 'N/A' }}</div>
        <div *ngIf="reportType"> <strong>Type:</strong> {{ reportType }}</div>
      </div>
    </div>

    <!-- Bar chart (AT TOP) -->
    <div class="chart-area mb-6">
      <h3 class="text-sm font-medium text-slate-700 mb-2">Revenue by Venue</h3>
      <div class="w-full">
        <canvas id="topBarChart" style="max-height:300px;"></canvas>
      </div>
    </div>

    <!-- Summary grid -->
    <div class="summary-grid grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
      <div class="summary-card p-3 border rounded">
        <div class="text-xs text-slate-600">Total Bookings</div>
        <div class="text-xl font-bold text-slate-800">{{ stats.totalBookings | number }}</div>
      </div>

      <div class="summary-card p-3 border rounded">
        <div class="text-xs text-slate-600">Total Customers</div>
        <div class="text-xl font-bold text-slate-800">{{ stats.totalCustomers | number }}</div>
      </div>

      <div class="summary-card p-3 border rounded">
        <div class="text-xs text-slate-600">Total Revenue</div>
        <div class="text-xl font-bold text-slate-800">{{ stats.totalRevenue | number:'1.0-0' }} TZS</div>
      </div>

      <div class="summary-card p-3 border rounded">
        <div class="text-xs text-slate-600">Completed Bookings</div>
        <div class="text-xl font-bold text-slate-800">{{ stats.completedBookings | number }}</div>
      </div>

      <div class="summary-card p-3 border rounded">
        <div class="text-xs text-slate-600">Most Booked Venue</div>
        <div class="text-lg font-semibold text-slate-800">{{ stats.mostBookedVenue || '–' }}</div>
      </div>

      <div class="summary-card p-3 border rounded">
        <div class="text-xs text-slate-600">Best Revenue Venue</div>
        <div class="text-lg font-semibold text-slate-800">{{ stats.bestRevenueVenue || '–' }}</div>
      </div>
    </div>

    <!-- Additional details table -->
    <div class="details mb-6">
      <h4 class="text-sm font-medium text-slate-700 mb-2">Top Customers & Venues</h4>

      <div class="grid md:grid-cols-2 gap-4">
        <div class="p-3 border rounded bg-gray-50">
          <div class="text-xs text-slate-600">Top Customer (by bookings)</div>
          <div class="text-lg font-semibold text-slate-800">{{ stats.topCustomer?.name || '–' }}</div>
          <div class="text-sm text-slate-600">Bookings: {{ stats.topCustomer?.bookings || 0 }}</div>
        </div>

        <div class="p-3 border rounded bg-gray-50">
          <div class="text-xs text-slate-600">Top Venues by Revenue</div>
          <ol class="mt-2 pl-4">
            <li *ngFor="let v of topRevenueVenues; index as i" class="text-sm text-slate-800">
              {{ i+1 }}. {{ v.venueName }} — {{ v.revenue | number:'1.0-0' }} TZS
            </li>
            <li *ngIf="!topRevenueVenues.length" class="text-sm text-gray-500">No data</li>
          </ol>
        </div>
      </div>
    </div>

    <!-- bookings weekly table (optional) -->
    <div *ngIf="reportData?.items?.length" class="bookings-table mb-6">
      <h4 class="text-sm font-medium text-slate-700 mb-2">Weekly Breakdown</h4>
      <div class="overflow-x-auto">
        <table class="w-full text-sm table-fixed border-collapse">
          <thead>
            <tr class="bg-slate-100">
              <th class="border px-3 py-2 text-left">Metric</th>
              <th class="border px-3 py-2 text-center">Week 1</th>
              <th class="border px-3 py-2 text-center">Week 2</th>
              <th class="border px-3 py-2 text-center">Week 3</th>
              <th class="border px-3 py-2 text-center">Week 4</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of reportData.items">
              <td class="border px-3 py-2">{{ row.name }}</td>
              <td class="border px-3 py-2 text-center">{{ row.week1 }}</td>
              <td class="border px-3 py-2 text-center">{{ row.week2 }}</td>
              <td class="border px-3 py-2 text-center">{{ row.week3 }}</td>
              <td class="border px-3 py-2 text-center">{{ row.week4 }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="report-footer text-xs text-slate-600 border-t pt-3">
      <div>Report generated by ZSSF Venue System.</div>
    </div>
  </div>

  <!-- empty state -->
  <div *ngIf="!reportData" class="mt-8 text-center text-slate-500">
    Generate a report to view printable PDF-styled output.
  </div>
</div>
