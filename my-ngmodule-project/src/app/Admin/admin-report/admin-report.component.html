<!-- admin-report.component.html -->
<div class="report-page p-6 min-h-screen" style="background-color:#f8fafc; color:#000;">
  <!-- controls (small, still available) -->
  <div class="controls mb-4 flex flex-wrap items-center gap-3 justify-between">
    <div class="flex items-center gap-3">
      <label class="text-sm font-medium">Report Type</label>
      <select [(ngModel)]="reportType" (change)="onReportTypeChange()" class="border px-3 py-1 rounded">
        <option value="MONTHLY">Monthly</option>
        <option value="QUARTERLY">Quarterly</option>
        <option value="YEARLY">Yearly</option>
      </select>

      <input *ngIf="reportType==='MONTHLY'" type="month" [(ngModel)]="selectedMonth" class="border px-3 py-1 rounded">
      <input *ngIf="reportType==='QUARTERLY'" type="number" min="1" max="4" [(ngModel)]="selectedQuarter" placeholder="Quarter (1–4)" class="border px-3 py-1 rounded w-28">
      <input type="number" min="2000" max="2100" [(ngModel)]="selectedYear" placeholder="Year" class="border px-3 py-1 rounded w-28">
      <button mat-flat-button color="primary" (click)="loadReport()">Generate</button>
    </div>

    <div class="actions flex items-center gap-2">
      <button mat-stroked-button color="primary" (click)="downloadReport()">Download PDF</button>
      <button mat-stroked-button color="accent" (click)="printReport()">Print</button>
    </div>
  </div>

  <!-- Actual report content (paper-like) -->
  <div #reportContent class="paper max-w-[900px] mx-auto p-6" style="background-color:#fff; color:#000; border-radius:4px; box-shadow:0 2px 6px rgba(0,0,0,0.1);">
    <!-- Header -->
    <div class="header flex justify-between items-start border-b pb-4 mb-6">
      <div>
        <h1 class="report-title text-2xl font-bold" style="color:#1e293b;">Venue Booking Summary Report</h1>
        <p class="text-sm mt-1" style="color:#475569;">ZSSF Venue Booking System</p>
      </div>
      <div class="text-right text-sm" style="color:#64748b;">
        <div><strong>Generated:</strong> {{ dateGenerated }}</div>
        <div><strong>Report Period:</strong> {{ reportPeriod || 'N/A' }}</div>
        <div *ngIf="reportType"> <strong>Type:</strong> {{ reportType }}</div>
      </div>
    </div>

    <!-- Bar chart (AT TOP) -->
    <div class="chart-area mb-6">
      <h3 class="text-sm font-medium mb-2" style="color:#475569;">Revenue by Venue</h3>
      <div class="w-full">
        <canvas id="topBarChart" style="max-height:300px;"></canvas>
      </div>
    </div>

    <!-- Summary grid -->
    <div class="summary-grid grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
      <div class="summary-card p-3" style="background-color:#fff; border:1px solid #0e067f; border-radius:4px;">
        <div class="text-xs" style="color:#64748b;">Total Bookings</div>
        <div class="text-xl font-bold" style="color:#1e293b;">{{ stats.totalBookings | number }}</div>
      </div>

      <div class="summary-card p-3" style="background-color:#fff; border:1px solid #0e067f; border-radius:4px;">
        <div class="text-xs" style="color:#64748b;">Total Customers</div>
        <div class="text-xl font-bold" style="color:#1e293b;">{{ stats.totalCustomers | number }}</div>
      </div>

      <div class="summary-card p-3" style="background-color:#fff; border:1px solid #0e067f; border-radius:4px;">
        <div class="text-xs" style="color:#64748b;">Total Revenue</div>
        <div class="text-xl font-bold" style="color:#1e293b;">{{ stats.totalRevenue | number:'1.0-0' }} TZS</div>
      </div>

      <div class="summary-card p-3" style="background-color:#fff; border:1px solid #0e067f; border-radius:4px;">
        <div class="text-xs" style="color:#64748b;">Completed Bookings</div>
        <div class="text-xl font-bold" style="color:#1e293b;">{{ stats.completedBookings | number }}</div>
      </div>

      <div class="summary-card p-3" style="background-color:#fff; border:1px solid #0e067f; border-radius:4px;">
        <div class="text-xs" style="color:#64748b;">Most Booked Venue</div>
        <div class="text-lg font-semibold" style="color:#1e293b;">{{ stats.mostBookedVenue || '–' }}</div>
      </div>

      <div class="summary-card p-3" style="background-color:#fff; border:1px solid #0e067f; border-radius:4px;">
        <div class="text-xs" style="color:#64748b;">Best Revenue Venue</div>
        <div class="text-lg font-semibold" style="color:#1e293b;">{{ stats.bestRevenueVenue || '–' }}</div>
      </div>
    </div>

    <!-- Additional details table -->
    <div class="details mb-6">
      <h4 class="text-sm font-medium mb-2" style="color:#475569;">Top Customers & Venues</h4>

      <div class="grid md:grid-cols-2 gap-4">
        <div class="p-3" style="background-color:#f1f5f9; border:1px solid #0e067f; border-radius:4px;">
          <div class="text-xs" style="color:#64748b;">Top Customer (by bookings)</div>
          <div class="text-lg font-semibold" style="color:#1e293b;">{{ stats.topCustomer?.name || '–' }}</div>
          <div class="text-sm" style="color:#64748b;">Bookings: {{ stats.topCustomer?.bookings || 0 }}</div>
        </div>

        <div class="p-3" style="background-color:#f1f5f9; border:1px solid #0e067f; border-radius:4px;">
          <div class="text-xs" style="color:#64748b;">Top Venues by Revenue</div>
          <ol class="mt-2 pl-4">
            <li *ngFor="let v of topRevenueVenues; index as i" class="text-sm" style="color:#1e293b;">
              {{ i+1 }}. {{ v.venueName }} — {{ v.revenue | number:'1.0-0' }} TZS
            </li>
            <li *ngIf="!topRevenueVenues.length" class="text-sm" style="color:#475569;">No data</li>
          </ol>
        </div>
      </div>
    </div>

   <!-- bookings weekly table (optional) -->
<div *ngIf="reportData?.items?.length" class="bookings-table" 
     style="page-break-before: always; background: #fff; color:#000; border-radius:4px; max-width:900px; margin:0 auto; display:flex; flex-direction:column; padding:12px;">
  
  <!-- Title -->
  <h4 style="text-align:center; color:#475569; margin:0 0 6px 0; font-size:16px;">Weekly Breakdown</h4>

  <!-- Table -->
  <div style="flex:1; display:flex; justify-content:center; align-items:flex-start;">
    <table class="w-full max-w-[850px] text-sm table-fixed" style="border-collapse:collapse; text-align:center;">
      <thead>
        <tr style="background-color:#62add8;">
          <th class="border px-3 py-2 text-left" style="color:#000;">Metric</th>
          <th class="border px-3 py-2" style="color:#000;">Week 1</th>
          <th class="border px-3 py-2" style="color:#000;">Week 2</th>
          <th class="border px-3 py-2" style="color:#000;">Week 3</th>
          <th class="border px-3 py-2" style="color:#000;">Week 4</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of reportData.items">
          <td class="border px-3 py-2">{{ row.name }}</td>
          <td class="border px-3 py-2">{{ row.week1 }}</td>
          <td class="border px-3 py-2">{{ row.week2 }}</td>
          <td class="border px-3 py-2">{{ row.week3 }}</td>
          <td class="border px-3 py-2">{{ row.week4 }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Footer -->
  <div style="text-align:left; font-weight:normal; font-size:10px; margin-top:12px;">
    Report generated by ZSSF Venue System
  </div>
</div>


  <!-- Footer -->
  <!-- <div style="text-align:left; font-weight:normal; font-size:14px; margin-top:auto;">
    Report generated by ZSSF Venue System
  </div>
</div> -->

  <!-- empty state -->
  <div *ngIf="!reportData" class="mt-8 text-center" style="color:#64748b;">
    Generate a report to view printable PDF-styled output.
  </div>
</div>
