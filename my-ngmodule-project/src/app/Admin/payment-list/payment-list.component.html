<div *ngIf="loading" class="text-center py-8">
  <div class="mx-auto w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin" aria-label="Loading payments spinner"></div>
  <p class="mt-2 text-gray-500">Loading paymentsâ€¦</p>
</div>

<!-- Filters Section -->
<div class="bg-white shadow rounded p-4 m-5">
  <div class="flex flex-col md:flex-row gap-4 items-end">

    <!-- Phone Number Filter -->
    <div class="flex flex-col">
      <label class="text-gray-700 text-sm mb-1">Phone Number</label>
      <input 
        type="text" 
        placeholder="Enter phone number"
        [(ngModel)]="filterPhone"
        class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
    </div>

    <!-- Venue Filter -->
    <div class="flex flex-col">
      <label class="text-gray-700 text-sm mb-1">Venue</label>
      <select 
        [(ngModel)]="filterVenue"
        class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <option value="">All Venues</option>
        <option *ngFor="let venue of venues" [value]="venue">{{ venue }}</option>
      </select>
    </div>

    <!-- Payment Date Filter -->
    <div class="flex flex-col">
      <label class="text-gray-700 text-sm mb-1">Payment Date</label>
      <input 
        type="date" 
        [(ngModel)]="filterDate"
        class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
    </div>

  </div>
</div>

<!-- Payments Table -->
<table *ngIf="!loading" class="min-w-full border-collapse border border-gray-300">
  <thead class="bg-blue-100">
    <tr>
      <th class="border border-gray-300 px-4 py-2">Booking Code</th>
      <th class="border border-gray-300 px-4 py-2">Amount Paid</th>
      <th class="border border-gray-300 px-4 py-2">Customer Name</th>
      <th class="border border-gray-300 px-4 py-2">Phone Number</th>
      <th class="border border-gray-300 px-4 py-2">Venue</th>
      <th class="border border-gray-300 px-4 py-2">Activity</th>
      <th class="border border-gray-300 px-4 py-2">Payment Date</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let payment of filteredPayments()" class="hover:bg-gray-50">
      <td class="border border-gray-300 px-4 py-2">{{ payment.booking?.bookingCode || 'N/A' }}</td>
      <td class="border border-gray-300 px-4 py-2">{{ payment.amountPaid | currency:'TZS':'symbol' }}</td>
      <td class="border border-gray-300 px-4 py-2">{{ payment.customer?.customerName || 'N/A' }}</td>
      <td class="border border-gray-300 px-4 py-2">{{ payment.customerPhone || 'N/A' }}</td>
      <td class="border border-gray-300 px-4 py-2">{{ payment.venue || 'N/A' }}</td>
      <td class="border border-gray-300 px-4 py-2">{{ payment.activity || 'N/A' }}</td>
      <td class="border border-gray-300 px-4 py-2">{{ payment.paymentDate | date:'short' }}</td>
    </tr>
  </tbody>
</table>
