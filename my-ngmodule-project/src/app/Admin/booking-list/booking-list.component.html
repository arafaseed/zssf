
<h3 class="text-lg font-semibold text-slate-800 mb-3 ml-4" id="bookings">
  Bookings
</h3>

<mat-card class="booking-card m-5 ">
  <div class="controls flex flex-wrap gap-3 p-4 items-center">
    <!-- Status toggles -->
    <mat-button-toggle-group [value]="currentStatus" (change)="setStatus($event.value)" class="inline-flex">
      <mat-button-toggle *ngFor="let s of statusOptions" [value]="s" class="px-2 py-1">
        {{ s }}
      </mat-button-toggle>
    </mat-button-toggle-group>

    <!-- Customer type select -->
    <mat-form-field class="filter-field min-w-[180px]">
      <mat-label>Filter by Customer Type</mat-label>
      <mat-select [value]="currentCustomerType" (selectionChange)="setCustomerType($event.value)">
        <mat-option *ngFor="let t of customerTypeOptions" [value]="t">{{ t }}</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Date search -->
    <mat-form-field class="filter-field min-w-[180px]">
      <mat-label>Look for booking with Start Date</mat-label>
      <input matInput type="date" [value]="searchDate" (change)="onDateChange($event)">
      <button mat-icon-button matSuffix *ngIf="searchDate" aria-label="Clear" (click)="clearDate()">
        <mat-icon>clear</mat-icon>
      </button>
    </mat-form-field>

    <mat-form-field appearance="fill">
  <mat-label>Filter by Venue</mat-label>
  <mat-select [(value)]="venueId" (selectionChange)="setVenueFilter($event.value)">
    <mat-option [value]="0">All Venues</mat-option>
    <mat-option *ngFor="let v of venues" [value]="v.venueId">{{ v.venueName }}</mat-option>
  </mat-select>
</mat-form-field>


<mat-form-field class="filter-field min-w-[180px]">
  <mat-label>Filter by Phone Number</mat-label>
  <input matInput type="text" [value]="searchPhone" (input)="onPhoneChange($event)" placeholder="Enter phone number">
  <button mat-icon-button matSuffix *ngIf="searchPhone" aria-label="Clear" (click)="clearPhone()">
    <mat-icon>clear</mat-icon>
  </button>
</mat-form-field>

  </div>
</mat-card>

<div class="table-wrapper" *ngIf="!loading">
  <div class="flex justify-end gap-3 mb-3">

 <button
  (click)="printTable()"
  class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-5 py-2.5 rounded-lg shadow-md transition-all duration-200"
  style="font-family: 'Inter', 'Roboto', 'Segoe UI', sans-serif;"
>
  <mat-icon class="!text-[22px]">print</mat-icon>
  <span class="tracking-wide text-[15px]">Print</span>
</button>


  <!-- <button mat-raised-button color="accent" (click)="downloadTable()">Download PDF</button> -->
</div>

  <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z2 w-full table-auto">

    <!-- Booking Code -->
    <ng-container matColumnDef="bookingCode">
      <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-4 py-3 text-left text-sm">Booking Code</th>
      <td mat-cell *matCellDef="let row" class="px-4 py-3 text-sm">{{ row.bookingCode }}</td>
    </ng-container>

    <!-- Booking Date -->
    <ng-container matColumnDef="bookingDate">
      <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-4 py-3 text-left text-sm">Booking Date</th>
      <td mat-cell *matCellDef="let row" class="px-4 py-3 text-sm">{{ formatDate(row.bookingDate) }}</td>
    </ng-container>

    <!-- Activity -->
    <ng-container matColumnDef="activity">
      <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-4 py-3 text-left text-sm">Activity</th>
      <td mat-cell *matCellDef="let row" class="px-4 py-3 text-sm">{{ row.venueActivityName || '-' }}</td>
    </ng-container>

    <!-- Venue -->
    <ng-container matColumnDef="venue">
      <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-4 py-3 text-left text-sm">Venue</th>
      <td mat-cell *matCellDef="let row" class="px-4 py-3 text-sm">{{ row.venueName || '-' }}</td>
    </ng-container>

    <!-- Customer -->
    <ng-container matColumnDef="customer">
      <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-4 py-3 text-left text-sm">Customer</th>
      <td mat-cell *matCellDef="let row" class="px-4 py-3 text-sm">{{ row.customer?.customerName }}</td>
    </ng-container>

    <!-- Phone Number -->
    <ng-container matColumnDef="phoneNumber">
      <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-4 py-3 text-left text-sm">Phone Number</th>
      <td mat-cell *matCellDef="let row" class="px-4 py-3 text-sm">{{ row.customer?.phoneNumber || '-' }}</td>
    </ng-container>

    <!-- Customer Type -->
    <ng-container matColumnDef="customerType">
      <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-4 py-3 text-left text-sm">Customer Type</th>
      <td mat-cell *matCellDef="let row" class="px-4 py-3 text-sm">{{ row.customer?.customerType }}</td>
    </ng-container>

    <!-- Start Date -->
    <ng-container matColumnDef="startDate">
      <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-4 py-3 text-left text-sm">Start Date</th>
      <td mat-cell *matCellDef="let row" class="px-4 py-3 text-sm">{{ formatDate(row.startDate) }}</td>
    </ng-container>

    <!-- Start Time -->
    <ng-container matColumnDef="startTime">
      <th mat-header-cell *matHeaderCellDef class="px-4 py-3 text-left text-sm">Start Time</th>
      <td mat-cell *matCellDef="let row" class="px-4 py-3 text-sm">{{ row.startTime }}</td>
    </ng-container>

    <!-- End Date -->
    <ng-container matColumnDef="endDate">
      <th mat-header-cell *matHeaderCellDef class="px-4 py-3 text-left text-sm">End Date</th>
      <td mat-cell *matCellDef="let row" class="px-4 py-3 text-sm">{{ formatDate(row.endDate) }}</td>
    </ng-container>

    <!-- End Time -->
    <ng-container matColumnDef="endTime">
      <th mat-header-cell *matHeaderCellDef class="px-4 py-3 text-left text-sm">End Time</th>
      <td mat-cell *matCellDef="let row" class="px-4 py-3 text-sm">{{ row.endTime }}</td>
    </ng-container>

    <!-- Status -->
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef mat-sort-header class="px-4 py-3 text-left text-sm">Status</th>
      <td mat-cell *matCellDef="let row" class="px-4 py-3 text-sm">
        <span [ngStyle]="{ color: getStatusColor(row.bookingStatus) }" class="font-medium">
          {{ row.bookingStatus }}
        </span>
      </td>
    </ng-container>

    <!-- Reference document button -->
    <ng-container matColumnDef="reference">
      <th mat-header-cell *matHeaderCellDef class="px-4 py-3 text-left text-sm">Reference</th>
      <td mat-cell *matCellDef="let row" class="px-4 py-3 text-sm">
        <button mat-raised-button color="primary" (click)="openReferenceDocs(row)" [disabled]="!(row.customer?.referenceDocument?.length)">
          View Docs
        </button>

        <app-pdf-viewer-overlay
          *ngIf="showPdfOverlay"
          #pdfOverlay
          [bookingId]="selectedBookingId"
          [bookingCode]="selectedBookingCode"
          [docs]="selectedDocs"
          [authToken]="pdfAuthToken"
          (closed)="closePdfPreview()"
          (click)="$event.stopPropagation()">
        </app-pdf-viewer-overlay>
      </td>
    </ng-container>

    <!-- header and rows -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-[#0c1429] text-white"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-slate-50"></tr>
  </table>

  <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons class="mt-3"></mat-paginator>
</div>

<div *ngIf="loading" class="loading-wrap flex justify-center py-6">
  <mat-spinner diameter="40"></mat-spinner>
</div>

<div *ngIf="!loading && dataSource.data.length === 0" class="no-results text-center py-4">
  <p class="font-semibold">No bookings found.</p>
</div>