<div class="flex flex-col items-center gap-4 p-4">
  <!-- Scanner view -->
  <div #scanner id="qr-scanner"
       class="w-80 h-80 bg-slate-50 rounded-lg overflow-hidden flex items-center justify-center border border-slate-200">
    <div *ngIf="!scanning && !verifying" class="text-slate-400 text-center px-4">
      <!-- icon -->
      <svg class="w-12 h-12 mx-auto mb-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 7V5a2 2 0 0 1 2-2h2" stroke="#94A3B8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M21 17v2a2 2 0 0 1-2 2h-2" stroke="#94A3B8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M7 21H5a2 2 0 0 1-2-2v-2" stroke="#94A3B8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M17 3h2a2 2 0 0 1 2 2v2" stroke="#94A3B8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        <rect x="7" y="7" width="10" height="10" rx="1" stroke="#94A3B8" stroke-width="1.2"/>
      </svg>
      <div class="text-sm text-slate-500">Scanner ready — press Start Camera</div>
    </div>

    <div *ngIf="scanning && !verifying" class="text-center text-sm text-slate-700 px-2">
      <div>Scanning... point camera at invoice QR code</div>
      <div class="mt-2 text-xs text-slate-500">Tip: Hold phone steady & ensure QR fits inside box</div>
    </div>

    <div *ngIf="verifying" class="flex flex-col items-center gap-2">
      <mat-progress-spinner diameter="32" mode="indeterminate"></mat-progress-spinner>
      <div class="text-sm text-slate-700">Verifying code — please wait...</div>
    </div>
  </div>

  <!-- Controls -->
  <div class="flex gap-3">
    <button (click)="startScanner()"
            [disabled]="scanning || verifying"
            class="px-4 py-2 rounded-md bg-cyan-500 hover:bg-cyan-600 text-white font-medium disabled:opacity-50">
      Start Camera
    </button>

    <button (click)="stopScanner()"
            [disabled]="!scanning || verifying"
            class="px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300 text-slate-700 font-medium disabled:opacity-50">
      Stop
    </button>

    <button (click)="lastDecodedText=''; message=''; foundInvoice=null;"
            class="px-4 py-2 rounded-md bg-amber-100 text-amber-800 font-medium">
      Clear
    </button>
  </div>

  <!-- Status message -->
  <div *ngIf="message" [ngClass]="{'text-red-600': !foundInvoice, 'text-emerald-700': foundInvoice}"
       class="text-sm text-center px-2">
    {{ message }}
  </div>

  <!-- Invoice preview when found -->
  <div *ngIf="foundInvoice" class="w-full max-w-md border rounded-md p-3 bg-white shadow-sm mt-2">
    <div class="flex items-center justify-between mb-2">
      <div>
        <div class="text-sm font-semibold">Invoice: {{ foundInvoice.invoiceCode }}</div>
        <div class="text-xs text-slate-500">Booking: {{ foundInvoice?.booking?.bookingId ?? foundInvoice.bookingId ?? '-' }}</div>
      </div>
      <div class="text-right">
        <div class="text-sm font-medium">{{ foundInvoice.netAmount ? (foundInvoice.netAmount | number:'1.2-2') : (foundInvoice.amount | number:'1.2-2') }} TZS</div>
        <div class="text-xs text-slate-400">Status: {{ foundInvoice.invoicestatus ?? foundInvoice.status }}</div>
      </div>
    </div>

    <div class="flex gap-2 mt-3">
      <button (click)="openFoundInvoice()"
        class="px-3 py-2 rounded bg-emerald-600 text-white">
  Open Invoice Page
</button>


      <button (click)="foundInvoice=null; message='';"
              class="px-3 py-2 rounded bg-gray-100">
        Close
      </button>
    </div>
  </div>

  <!-- Small hint -->
  <div class="text-xs text-slate-500 text-center px-2 mt-2">
    Make sure you allow camera access when the browser prompts you. If you blocked access earlier, open site settings and allow camera.
  </div>
</div>
