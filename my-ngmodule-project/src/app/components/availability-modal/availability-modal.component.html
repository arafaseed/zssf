<!-- Title -->
<h2 mat-dialog-title class="flex items-center justify-between gap-3">
  <span class="font-semibold">{{ 'availability.title' | translate }} â€” {{ data?.venueName }}</span>
  <button mat-icon-button aria-label="close" (click)="cancel()">
    <i-lucide-x class="w-5 h-5"></i-lucide-x>
  </button>
</h2>

<mat-dialog-content class="px-4 py-3 max-h-[70vh] overflow-auto">
  <!-- Loading -->
  <div *ngIf="loading" class="flex justify-center py-8">
    <mat-progress-spinner diameter="44" mode="indeterminate"></mat-progress-spinner>
  </div>


  <!-- Results -->
  <div *ngIf="!loading && availability?.length">
    <!-- All Available -->
    <div *ngIf="allAvailable" class="flex items-center gap-3 p-3 mb-3 border rounded-lg bg-emerald-50 border-emerald-100">
      <i-lucide-check-circle class="w-5 h-5 text-emerald-600"></i-lucide-check-circle>
      <div>
        <div class="font-medium">{{ 'availability.allAvailable' | translate }}</div>
        <div class="text-sm text-slate-600">{{ 'availability.allAvailableHint' | translate }}</div>
      </div>
    </div>

    <!-- Some Not Available -->
    <div *ngIf="!allAvailable" class="flex items-center gap-3 p-3 mb-3 border border-red-100 rounded-lg bg-yellow-50">
      <p class="mb-2 text-sm text-slate-600">
        {{ 'availability.someUnavailable' | translate }}
      </p>
    </div>

    <!-- selection list: multiple selection allowed; we expose selected value objects -->
    <!-- NOTE: [selected] controls the initial checked state per item based on autoCheckEnabled -->
    <mat-selection-list #selectionList="matSelectionList" [multiple]="true" (selectionChange)="onSelectionChange($event)">
      <mat-list-option
        *ngFor="let it of availability"
        [value]="it"
        class="py-3 min-h-[100px]"
        [selected]="autoCheckEnabled && it.flag === 'AVAILABLE_FOR_BOOKING'">
        <div class="flex items-start justify-between w-full gap-">
          <div class="flex-3">
            <div class="flex items-center gap-2">
              <div class="font-medium">{{ it.date }}</div>
              <!-- Blocked -->
            <div *ngIf="it.flag === 'BLOCKED'" class="flex items-center gap-1 text-sm text-gray-600">
              <i-lucide-slash class="w-4 h-4"></i-lucide-slash> This date is blocked and can't be booked 
            </div>
              <div *ngIf="it.flag === 'AVAILABLE_FOR_BOOKING'" class="flex items-center gap-1 text-sm text-emerald-600">
                <i-lucide-check-circle class="w-4 h-4"></i-lucide-check-circle> {{ 'availability.status.available' | translate }}
              </div>
              <div *ngIf="it.flag === 'ALREADY_BOOKED'" class="flex items-center gap-1 text-sm text-rose-600">
                <i-lucide-x-circle class="w-4 h-4"></i-lucide-x-circle> {{ 'availability.status.booked' | translate }}
                <p class="text-xs">- {{ 'availability.statusLabel' | translate }}: {{ it.status }}</p>
              </div>
            </div>

            <div *ngIf="it.pendingExpiresInMinutes" class="mt-2 text-xs text-amber-600">
              {{ 'availability.pendingExpires' | translate:{minutes: it.pendingExpiresInMinutes} }}
            </div>

            <div *ngIf="it.bookedStart" class="mt-2 text-xs">
              {{ 'availability.bookedTime' | translate:{start: it.bookedStart, end: it.bookedEnd} }}
            </div>
          </div>
        </div>
      </mat-list-option>
    </mat-selection-list>
  </div>

  <!-- No Data -->
  <div *ngIf="!loading && (!availability || availability.length === 0)" class="text-slate-600">
    {{ 'availability.noData' | translate }}
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end" class="px-4 pb-3">
  <div class="flex items-center justify-between w-full gap-3">
    <button mat-stroked-button (click)="cancel()">{{ 'availability.back' | translate }}</button>

    <div class="flex items-center gap-2">
      <button mat-stroked-button color="primary" (click)="check()" class="mr-2">
        {{ 'availability.refresh' | translate }}
      </button>
      <!-- updated disabled binding uses a computed property -->
      <button mat-flat-button color="primary" (click)="continueWithRange()" [disabled]="!isContinueEnabled">
        {{ 'availability.continue' | translate }}
      </button>
    </div>
  </div>
</mat-dialog-actions>
