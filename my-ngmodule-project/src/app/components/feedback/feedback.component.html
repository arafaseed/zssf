<app-header></app-header>

<div class="flex justify-center bg-gray-100 px-4 py-6">
  <div class="w-full max-w-2xl bg-white rounded-2xl shadow-md p-6 sm:p-8 mt-6">

    <h2 class="text-2xl sm:text-3xl font-bold text-center text-[#2A7261] mb-4">
      {{ 'feedback.title' | translate }}
    </h2>

    <p class="text-sm text-gray-700 mb-4">
      {{ 'feedback.description' | translate }}
    </p>

    <form [formGroup]="form" (ngSubmit)="submitFeedback()" class="space-y-5">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <mat-form-field class="w-full">
          <mat-label>{{ 'feedback.name' | translate }}</mat-label>
          <input matInput formControlName="name" [placeholder]="'feedback.placeholderName' | translate">
          <mat-error *ngIf="form.controls['name'].hasError('required')">
            {{ 'feedback.errors.nameRequired' | translate }}
          </mat-error>
        </mat-form-field>

        <mat-form-field class="w-full">
          <mat-label>{{ 'feedback.phone' | translate }}</mat-label>
          <!-- added blur handler -->
          <input matInput formControlName="phone" (blur)="onPhoneBlur()" [placeholder]="'feedback.placeholderPhone' | translate" required>
          <mat-error *ngIf="form.controls['phone'].hasError('required')">
            {{ 'feedback.errors.phoneRequired' | translate }}
          </mat-error>
          <mat-error *ngIf="form.controls['phone'].hasError('pattern')">
            {{ 'feedback.errors.phoneInvalid' | translate }}
          </mat-error>
        </mat-form-field>
      </div>

      <mat-form-field class="w-full">
        <mat-label>{{ 'feedback.email' | translate }}</mat-label>
        <input matInput formControlName="email" [placeholder]="'feedback.placeholderEmail' | translate">
        <mat-error *ngIf="form.controls['email'].hasError('email')">
          {{ 'feedback.errors.emailInvalid' | translate }}
        </mat-error>
      </mat-form-field>

      <div>
        <label class="block mb-2 text-sm font-medium text-gray-700">{{ 'feedback.type' | translate }}</label>
        <p class="text-sm text-gray-600 mb-6 italic">
          {{ 'feedback.tip' | translate }}
        </p>

        <mat-radio-group formControlName="type" class="flex gap-4">
          <mat-radio-button value="FEEDBACK">{{ 'feedback.feedback' | translate }}</mat-radio-button>
          <mat-radio-button value="COMPLAINT">{{ 'feedback.complaint' | translate }}</mat-radio-button>
        </mat-radio-group>
      </div>

      <!-- Inline verification status -->
      <div class="mb-2">
        <p *ngIf="phoneVerified === true" class="text-sm text-green-700">
          {{ 'feedback.phoneVerified' | translate }}
        </p>
        <p *ngIf="phoneVerified === false" class="text-sm text-red-700">
          {{ 'feedback.phoneNotRegistered' | translate }}
        </p>
      </div>

      <mat-form-field class="w-full">
        <mat-label>{{ 'feedback.message' | translate }}</mat-label>
        <!-- the comment control is programmatically disabled until phone verification passes -->
        <textarea matInput rows="5" formControlName="comment" [placeholder]="'feedback.placeholderMessage' | translate"></textarea>
        <mat-error *ngIf="form.controls['comment'].hasError('required')">
          {{ 'feedback.errors.messageRequired' | translate }}
        </mat-error>
      </mat-form-field>

      <div class="flex gap-4">
        <button mat-flat-button color="primary" type="submit" [disabled]="sending || phoneVerified === false" class="flex-1">
          <mat-icon class="mr-2">send</mat-icon>
          {{ sending ? ('feedback.sending' | translate) : ('feedback.submit' | translate) }}
        </button>

        <button mat-stroked-button type="button" (click)="onCancel()" class="flex-1">
          {{ 'feedback.cancel' | translate }}
        </button>
      </div>

      <div *ngIf="successMessage" class="mt-3 p-3 bg-green-50 rounded text-green-800">
        {{ successMessage }}
      </div>
    </form>
  </div>
</div>

<app-footer></app-footer>
