<div class="main-wrapper">
  <app-header></app-header>
  <main class="content-container">
    <mat-card class="search-card">
      <mat-card-header>
        <mat-card-title class="card-title">Search Bookings</mat-card-title>
        <mat-card-subtitle class="card-subtitle">by Phone Number</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <form (ngSubmit)="onSubmit()" #searchForm="ngForm" class="search-form">
          <mat-form-field class="full-width-input">
            <mat-label>Phone Number</mat-label>
            <input
              matInput
              type="tel"
              name="phoneNumber"
              [(ngModel)]="phoneNumber"
              required
              pattern="^[0-9]{10}$"
              minlength="10"
              maxlength="10"
              #phoneInput="ngModel"
              (keypress)="validateNumberInput($event)"
            />
            <mat-icon matSuffix>phone</mat-icon>
            <mat-error *ngIf="phoneInput.errors?.['required']">
              Phone number is required.
            </mat-error>
            <mat-error *ngIf="phoneInput.errors?.['pattern']">
              Please enter exactly 10 digits.
            </mat-error>
          </mat-form-field>

          <button
            mat-flat-button
            color="primary"
            type="submit"
            [disabled]="!searchForm.valid || searching"
            class="search-button"
          >
            <mat-spinner *ngIf="searching" [diameter]="20" class="spinner"></mat-spinner>
            <span *ngIf="!searching">Search</span>
          </button>
        </form>
      </mat-card-content>
    </mat-card>
    <div *ngIf="bookings.length > 0" class="results-container">
      <h4 class="results-title">Search Results</h4>
      <div *ngFor="let booking of bookings" class="booking-card-wrapper">
        <mat-card class="booking-card">
          <mat-card-content>
            <div class="booking-details-grid">
              <p><strong>Booking Code:</strong> {{ booking.bookingCode }}</p>
              <p><strong>Customer</strong> {{booking.customer.customerName}}</p>
              <p><strong>Booking date</strong> {{booking.bookingDate}}</p>
              <p><strong>Event Start date:</strong> {{ booking.startDate | date }} {{ booking.startTime }}</p>
              <p><strong>Event End date:</strong> {{ booking.endDate | date }} {{ booking.endTime }}</p>
              <p><strong>Status:</strong> <span [ngClass]="{'status-pending': booking.bookingStatus === 'PENDING', 'status-complete': booking.bookingStatus === 'COMPLETED'}">{{ booking.bookingStatus }}</span></p>
              <p><strong>Venue:</strong> {{ booking.venueName }} </p>
              <p><strong>Activity:</strong> {{ booking.venueActivityName }}</p>
              <p><strong>View invoice for more info</strong></p>
            </div>
            <mat-divider class="my-4"></mat-divider>
            <div class="booking-actions">
              <a
                *ngIf="booking.invoiceId"
                [href]="'/invoice/' + booking.invoiceId"
                target="_blank"
                mat-flat-button
                color="primary"
                class="action-button"
              >
                View Invoice
              </a>

              <a
                *ngIf="booking.invoiceId"
                [href]="'/invoice/' + booking.invoiceId"
                target="_blank"
                mat-flat-button
                color="primary"
                class="action-button"
              >
                Update Reservation
              </a>

              <button
                *ngIf="booking.bookingStatus.toLowerCase() !== 'completed' && booking.bookingStatus.toLowerCase() !== 'cancelled'"
                mat-flat-button
                color="warn"
                class="action-button"
                (click)="cancelBooking(booking.bookingId)"
              >
                Cancel Booking
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
    <mat-card *ngIf="noResults" class="no-results-card">
      <mat-card-content>
        <p class="no-results-text">
          <mat-icon color="warn">info</mat-icon>
          No bookings found for phone number <strong>{{ phoneNumber }}</strong>.
        </p>
      </mat-card-content>
    </mat-card>
  </main>
  <app-footer></app-footer>
</div>