<div class="main-wrapper">
  <app-header></app-header>
  <main class="content-container">
    <mat-card class="search-card">
      <mat-card-header>
        <mat-card-title class="card-title">{{ 'phoneSearch.title' | translate }}</mat-card-title>
        <mat-card-subtitle class="card-subtitle">{{ 'phoneSearch.subtitle' | translate }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <form (ngSubmit)="onSubmit()" #searchForm="ngForm" class="search-form">
          <mat-form-field class="full-width-input">
            <mat-label>{{ 'phoneSearch.phoneLabel' | translate }}</mat-label>
            <input
              matInput
              type="tel"
              name="phoneNumber"
              [(ngModel)]="phoneNumber"
              required
              pattern="^[0-9]{10}$"
              minlength="10"
              maxlength="10"
              #phoneInput="ngModel"
              (keypress)="validateNumberInput($event)"
              [placeholder]="'phoneSearch.phonePlaceholder' | translate"
            />
            <mat-icon matSuffix>phone</mat-icon>

            <mat-error *ngIf="phoneInput.errors?.['required']">
              {{ 'phoneSearch.errors.required' | translate }}
            </mat-error>
            <mat-error *ngIf="phoneInput.errors?.['pattern']">
              {{ 'phoneSearch.errors.pattern' | translate }}
            </mat-error>
          </mat-form-field>

          <button
            mat-flat-button
            color="primary"
            type="submit"
            [disabled]="!searchForm.valid || searching"
            class="search-button"
          >
            <mat-spinner *ngIf="searching" [diameter]="20" class="spinner"></mat-spinner>
            <span *ngIf="!searching">{{ 'phoneSearch.searchButton' | translate }}</span>
          </button>
        </form>
      </mat-card-content>
    </mat-card>

    <div *ngIf="bookings.length > 0" class="results-container">
      <h4 class="results-title">{{ 'phoneSearch.resultsTitle' | translate }}</h4>
      <div *ngFor="let booking of bookings" class="booking-card-wrapper">
        <mat-card class="booking-card">
          <mat-card-content>
            <div class="booking-details-grid">
              <p><strong>{{ 'phoneSearch.bookingCode' | translate }}:</strong> {{ booking.bookingCode }}</p>
              <p><strong>{{ 'phoneSearch.customer' | translate }}:</strong> {{booking.customer.customerName}}</p>
              <p><strong>{{ 'phoneSearch.bookingDate' | translate }}:</strong> {{booking.bookingDate}}</p>
              <p><strong>{{ 'phoneSearch.eventStartDate' | translate }}:</strong> {{ booking.startDate | date }} {{ booking.startTime }}</p>
              <p><strong>{{ 'phoneSearch.eventEndDate' | translate }}:</strong> {{ booking.endDate | date }} {{ booking.endTime }}</p>
              <p><strong>{{ 'phoneSearch.status' | translate }}:</strong> <span [ngClass]="{'status-cancelled': booking.bookingStatus === 'CANCELLED',
                'status-expired': booking.bookingStatus === 'EXPIRED',
                'status-pending': booking.bookingStatus === 'PENDING', 
                'status-in-progress': booking.bookingStatus === 'IN_PROGRESS','status-complete': booking.bookingStatus === 'COMPLETE'}">{{ booking.bookingStatus }}</span></p>
              <p><strong>{{ 'phoneSearch.venue' | translate }}:</strong> {{ booking.venueName }} </p>
              <p><strong>{{ 'phoneSearch.activity' | translate }}:</strong> {{ booking.venueActivityName }}</p>
              <p><strong>{{ 'phoneSearch.moreInfo' | translate }}</strong></p>
            </div>

            <mat-divider class="my-4"></mat-divider>

            <div class="booking-actions">
              <a
                *ngIf="booking.invoiceId"
                [href]="'/invoice/' + booking.invoiceId"
                target="_blank"
                mat-flat-button
                color="primary"
                class="action-button"
              >
                {{ 'phoneSearch.viewInvoice' | translate }}
              </a>

              <!-- <a
                *ngIf="booking.invoiceId"
                [href]="'/feedback/' + booking.invoiceId"
                target="_blank"
                mat-flat-button
                color="primary"
                class="action-button"
              >
                Update Reservation
              </a> -->

              <!-- Postpone Booking Button -->
<button
  *ngIf="booking.bookingStatus.toLowerCase() !== 'completed' && booking.bookingStatus.toLowerCase() !== 'cancelled'"
  class="bg-amber-500 hover:bg-amber-600 text-white font-medium px-4 py-2 rounded-lg transition duration-200"
  (click)="openPostponeDialog(booking)"
>
  Postpone Booking
</button>

              <button
                *ngIf="booking.bookingStatus.toLowerCase() !== 'completed' && booking.bookingStatus.toLowerCase() !== 'cancelled'"
                mat-flat-button
                color="warn"
                class="action-button"
                (click)="cancelBooking(booking.bookingId)"
              >
                {{ 'phoneSearch.cancelBooking' | translate }}
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <mat-card *ngIf="noResults" class="no-results-card">
      <mat-card-content>
        <p class="no-results-text">
          <mat-icon color="warn">info</mat-icon>
          {{ 'phoneSearch.noResults' | translate }} <strong>{{ phoneNumber }}</strong>.
        </p>
      </mat-card-content>
    </mat-card>
  </main>
  <app-footer></app-footer>
</div>
